サービス開始・利用方法
======================

サービスの初期設定
------------------
サービス開始する前に、各サービスの初期設定を行う必要があります。

`bin/create-config` コマンドを実行することで、
config ディレクトリに以下のような設定ファイルが作成され、
サービスの初期設定が行われます。

config ディレクトリの内容:
```
pocci/
  - config/
    - nginx/                ... Nginx 設定
    - .env                  ... 環境変数定義
    - althosts              ... ホスト名 (IPアドレス) 定義 (hostsファイル形式)
    - backend-services.yml  ... バックエンドサービス用コンテナの定義 (Docker Compose形式)
    - core-services.yml     ... 各種サービス用コンテナ定義 (Docker Compose形式)
    - jenkins-slaves.yml    ... Jenkins スレーブノード用コンテナ定義 (Docker Compose形式)
```

サービスの初期設定は、次の3種類の方法のいずれかで実行できます。

1.  デフォルトの構成で実行する
2.  サービス構成タイプを指定して実行する
3.  サービス構成をカスタマイズして実行する



### 1. デフォルトの構成で実行する
#### 作成方法
`bin` ディレクトリにある `create-config` スクリプトを実行すると、
デフォルトの構成で初期設定できます。

```bash
cd bin
./create-config
```

*   サービス構成は `create-config` スクリプトを再実行することにより何度でもゼロからやり直すことができます。  
    とりあえず試してみたいときにはこの方法が一番簡単です。
*   設定ファイル作成には少し時間がかかります。  
    特に初回はイメージのダウンロードを行うため、
    ネットワーク環境によっては10分以上かかることもあります。
*   実行結果(ログ)は、端末画面、`pocci/config.log` もしくは Web 画面上の **Setup Log** で確認できます。


### 2. サービス構成タイプを指定して実行する

#### サービス構成タイプの指定
`create-config [サービス構成タイプ]` というふうに、
`create-config` に引数を追加することにより、
指定されたタイプの構成で初期設定することができます。

あらかじめ用意されているサービス構成には以下のものがあります。

サービス構成タイプ | 利用可能なサービス                                       | 特徴
------------------ | -------------------------------------------------------- | ----
default            | GitLab, Jenkins, SonarQube, かんばんボード, ユーザー管理 | チケット(Issue)管理はGitLabで行う。チケットをかんばんとしてタスクボード上で扱うことができる
redmine            | GitLab, Jenkins, SonarQube, Redmine, ユーザー管理        | チケット(Issue)管理はRedmineで行う


#### 実行例
例えば、Redmine を使用したい場合には、以下のように実行します。

```bash
./create-config redmine
```

引数を指定せずに `create-config` を実行した場合、`default` の構成で設定ファイル作成します。



### 3. サービス構成をカスタマイズして実行する

#### セットアップファイルの編集

セットアップファイル (`setup.*.yml`) を作成・編集することで、
サービス構成のカスタマイズや独自構成の定義ができます。

セットアップファイル (`setup.*.yml`) は、
`template` ディレクトリに存在します。

```
template/
  setup.default.yml
  setup.redmine.yml
```

これらのファイルをテキストエディタで編集すれば、
サービス構成タイプのカスタマイズを行うことができます。

また、`setup.myservices.yml` というように新しくファイルを作成することも可能です。
この場合、`./create-config myservices` というふうに引数指定すれば、
`create-config` は `setup.myservices.yml` を読み込んで実行します。

セットアップファイルの記述内容に関しては、
[セットアップファイル リファレンス](./setup-yml.ja.md) を参照してください。 



サービスの起動
--------------
### サービスの起動方法
`bin/up-service` コマンドを実行することでサービス起動できます。

```bash
cd bin
./up-service
```

### 起動したサービスへのアクセス方法
起動したCIサービスへのアクセス方法については、
[サービスへの接続方法](./access.ja.md)
を参照してください。


その他のコマンドについて
------------------------
サービス停止など、その他のコマンドに関しては、
[コマンドリファレンス](./command.ja.md) を参照してください。

