
KANBAN_VERSION=1.3.0
SERVICES_DIR=${TEMP_CONFIG_DIR}/services/core
KANBAN_DIR=${SERVICES_DIR}/volumes/kanban
KANBAN_COMPOSE_FILE=${SERVICES_DIR}/compose/kanban.yml.template
KANBAN_REPOSITORY=${KANBAN_REPOSITORY:-"https://github.com/leanlabsio/kanban.git"}

git clone ${KANBAN_REPOSITORY} ${KANBAN_DIR}
cd ${KANBAN_DIR}
git checkout ${KANBAN_VERSION}
mv .git .git.backup
echo ".git.backup" >>./.gitignore

cd ${BIN_DIR}
echo "cat << EOF" >${KANBAN_COMPOSE_FILE}
echo "#Kanban" >>${KANBAN_COMPOSE_FILE}
POCCIR_OPTS=" " \
    ./oneoff nodejs node \
    -e "require('./js/lib/kanban.js').edit('./js/config/services/core/volumes/kanban/docker-compose.yml')" | \
    tr -d '\r' >>${KANBAN_COMPOSE_FILE}
echo "EOF" >>${KANBAN_COMPOSE_FILE}
