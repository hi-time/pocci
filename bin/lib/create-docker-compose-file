
source ${LIB_DIR}/export-env ${CONFIG_DIR}/.env

# core-services.yml
if [ -f ${CONFIG_DIR}/core-services.yml ]; then
    rm ${CONFIG_DIR}/core-services.yml
fi
for i in ${INTERNAL_SERVICES}; do
    if [ -f ${TEMP_CONFIG_DIR}/services/core/$i/docker-compose.yml.template ]; then
        source ${TEMP_CONFIG_DIR}/services/core/$i/docker-compose.yml.template >>${CONFIG_DIR}/core-services.yml
    fi
done
if [ -f ${CONFIG_DIR}/core-services.yml ]; then
    source ${TEMP_CONFIG_DIR}/services/core/nginx/docker-compose.yml.template >>${CONFIG_DIR}/core-services.yml
fi

# backend-services.yml
if [ -f ${CONFIG_DIR}/backend-services.yml ]; then
    rm ${CONFIG_DIR}/backend-services.yml
fi
for i in $(find ${TEMP_CONFIG_DIR}/services/backend/ -name docker-compose.yml.template); do
    source $i >>${CONFIG_DIR}/backend-services.yml
done

# workspaces.yml
if [ -f ${TEMP_CONFIG_DIR}/workspaces.yml.template ]; then
    source ${TEMP_CONFIG_DIR}/workspaces.yml.template >${CONFIG_DIR}/workspaces.yml
    rm ${TEMP_CONFIG_DIR}/workspaces.yml.template
fi

if [ -d ${TEMP_CONFIG_DIR}/image ]; then
    if [ -d ${CONFIG_DIR}/image ]; then
        rm -fr ${CONFIG_DIR}/image
    fi
    cp -r ${TEMP_CONFIG_DIR}/image ${CONFIG_DIR}
    rm -fr ${TEMP_CONFIG_DIR}/image
fi


# workspace
for i in ${INTERNAL_SERVICES}; do
    if [ -f ${TEMP_CONFIG_DIR}/services/core/$i/setup-workspace.sh ]; then
        source ${TEMP_CONFIG_DIR}/services/core/$i/setup-workspace.sh
    fi
done
