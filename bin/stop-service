#!/bin/bash
set -e

if [ `docker ps |grep -e "${POCCI_SERVICE_PREFIX}_" -e "pocci[n|r]_" |wc -l` -eq 0 ]; then
    exit
fi

BASE_DIR=$(cd $(dirname $0)/..; pwd)
source ${BASE_DIR}/bin/lib/init-env

set +e
${BIN_DIR}/stop-jenkins-slave
${LIB_DIR}/docker-compose docker-compose.yml -p ${POCCI_SERVICE_PREFIX} stop
${LIB_DIR}/docker-compose dns.yml -p ${POCCI_SERVICE_PREFIX} stop

set -e
if [ `docker ps |grep -e "${POCCI_SERVICE_PREFIX}_" -e "pocci[n|r]_" |wc -l` -gt 0 ]; then
    `docker ps |grep -e "${POCCI_SERVICE_PREFIX}_" -e "pocci[n|r]_" |awk 'BEGIN{printf "docker stop "}{printf $1" "}'`
fi
